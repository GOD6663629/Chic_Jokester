<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tic-Tac-Toe | Chic Jokester</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../assets/styles.css">
    <style>
        .cell {
            width: 100px;
            height: 100px;
            transition: all 0.3s ease;
        }
        .cell:hover:not(.occupied) {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.3);
        }
        .winning-cell {
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-900 to-indigo-800 min-h-screen text-white">
    <div class="container mx-auto py-8 px-4">
        <header class="mb-8">
            <h1 class="text-4xl font-bold text-center">Tic-Tac-Toe</h1>
            <div class="flex justify-between items-center mt-4">
                <a href="../index.html" class="text-blue-300 hover:text-white">
                    <i class="fas fa-arrow-left mr-2"></i> Back to Games
                </a>
                <div class="score-display bg-white/10 px-4 py-2 rounded-full flex gap-4">
                    <div>
                        <span class="font-bold">X:</span> <span id="score-x">0</span>
                    </div>
                    <div>
                        <span class="font-bold">O:</span> <span id="score-o">0</span>
                    </div>
                </div>
            </div>
        </header>

        <main class="flex flex-col items-center">
            <div class="status mb-6 text-2xl font-semibold" id="status">Player X's turn</div>
            
            <div class="game-board grid grid-cols-3 gap-2 mb-8" id="game-board">
                <!-- 3x3 grid cells will be generated by JavaScript -->
            </div>

            <div class="controls flex gap-4">
                <button id="new-game-btn" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-full">
                    <i class="fas fa-redo mr-2"></i> New Game
                </button>
                <button id="ai-toggle" class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-2 rounded-full">
                    <i class="fas fa-robot mr-2"></i> Play vs AI
                </button>
            </div>
        </main>
    </div>

    <script src="../assets/utils.js"></script>
    <script>
        // Game variables
        let board = ['', '', '', '', '', '', '', '', ''];
        let currentPlayer = 'X';
        let gameActive = true;
        let scores = { X: 0, O: 0 };
        let vsAI = false;
        const winningCombinations = [
            [0, 1, 2], [3, 4, 5], [6, 7, 8], // rows
            [0, 3, 6], [1, 4, 7], [2, 5, 8], // columns
            [0, 4, 8], [2, 4, 6]             // diagonals
        ];

        // DOM elements
        const gameBoard = document.getElementById('game-board');
        const statusDisplay = document.getElementById('status');
        const scoreXDisplay = document.getElementById('score-x');
        const scoreODisplay = document.getElementById('score-o');
        const newGameBtn = document.getElementById('new-game-btn');
        const aiToggleBtn = document.getElementById('ai-toggle');

        // Initialize the game
        function initGame() {
            board = ['', '', '', '', '', '', '', '', ''];
            currentPlayer = 'X';
            gameActive = true;
            statusDisplay.textContent = `Player ${currentPlayer}'s turn`;
            renderBoard();
        }

        // Render the game board
        function renderBoard() {
            gameBoard.innerHTML = '';
            
            board.forEach((cell, index) => {
                const cellElement = document.createElement('div');
                cellElement.className = `cell flex items-center justify-center text-4xl font-bold bg-white/10 rounded-lg cursor-pointer ${cell ? 'occupied' : ''}`;
                cellElement.dataset.index = index;
                
                if (cell) {
                    cellElement.textContent = cell;
                    cellElement.classList.add(cell === 'X' ? 'text-red-400' : 'text-blue-400');
                }
                
                cellElement.addEventListener('click', () => handleCellClick(index));
                gameBoard.appendChild(cellElement);
            });
        }

        // Handle cell click
        function handleCellClick(index) {
            if (!gameActive || board[index] !== '') return;
            
            // Make the move
            board[index] = currentPlayer;
            renderBoard();
            
            // Check for win or draw
            const result = checkResult();
            if (result === 'win') {
                handleWin();
            } else if (result === 'draw') {
                handleDraw();
            } else {
                // Switch player
                currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
                statusDisplay.textContent = `Player ${currentPlayer}'s turn`;
                
                // If playing vs AI and it's AI's turn
                if (vsAI && currentPlayer === 'O' && gameActive) {
                    setTimeout(makeAIMove, 500);
                }
            }
        }

        // Check game result
        function checkResult() {
            // Check for win
            for (const combination of winningCombinations) {
                const [a, b, c] = combination;
                if (board[a] && board[a] === board[b] && board[a] === board[c]) {
                    return 'win';
                }
            }
            
            // Check for draw
            if (!board.includes('')) {
                return 'draw';
            }
            
            return null;
        }

        // Handle win
        function handleWin() {
            gameActive = false;
            scores[currentPlayer]++;
            updateScores();
            
            // Highlight winning cells
            for (const combination of winningCombinations) {
                const [a, b, c] = combination;
                if (board[a] && board[a] === board[b] && board[a] === board[c]) {
                    [a, b, c].forEach(index => {
                        const cell = document.querySelector(`[data-index="${index}"]`);
                        cell.classList.add('winning-cell');
                    });
                    break;
                }
            }
            
            statusDisplay.textContent = `Player ${currentPlayer} wins!`;
            showModal(`Player ${currentPlayer} wins!`, 'info');
            saveHighScore('tictactoe', scores[currentPlayer]);
            vibrate([100, 50, 100]);
        }

        // Handle draw
        function handleDraw() {
            gameActive = false;
            statusDisplay.textContent = 'Game ended in a draw!';
            showModal('Game ended in a draw!', 'info');
            vibrate(200);
        }

        // Update score display
        function updateScores() {
            scoreXDisplay.textContent = scores.X;
            scoreODisplay.textContent = scores.O;
        }

        // AI move logic
        function makeAIMove() {
            if (!gameActive) return;
            
            // Simple AI: first try to win, then block, then random move
            let move;
            
            // 1. Check for winning move
            move = findWinningMove('O');
            if (move === null) {
                // 2. Check for blocking move
                move = findWinningMove('X');
            }
            
            if (move === null) {
                // 3. Take center if available
                if (board[4] === '') {
                    move = 4;
                } else {
                    // 4. Random move
                    const availableMoves = board.map((cell, index) => cell === '' ? index : null).filter(val => val !== null);
                    move = availableMoves[Math.floor(Math.random() * availableMoves.length)];
                }
            }
            
            // Make the move
            board[move] = 'O';
            renderBoard();
            
            // Check result
            const result = checkResult();
            if (result === 'win') {
                handleWin();
            } else if (result === 'draw') {
                handleDraw();
            } else {
                currentPlayer = 'X';
                statusDisplay.textContent = `Player ${currentPlayer}'s turn`;
            }
        }

        // Find winning move for a player
        function findWinningMove(player) {
            for (const combination of winningCombinations) {
                const [a, b, c] = combination;
                // Check if two in a row and third is empty
                if (board[a] === player && board[b] === player && board[c] === '') return c;
                if (board[a] === player && board[c] === player && board[b] === '') return b;
                if (board[b] === player && board[c] === player && board[a] === '') return a;
            }
            return null;
        }

        // Toggle AI opponent
        function toggleAI() {
            vsAI = !vsAI;
            aiToggleBtn.textContent = vsAI ? 'Play vs Human' : 'Play vs AI';
            aiToggleBtn.classList.toggle('bg-purple-500');
            aiToggleBtn.classList.toggle('bg-green-500');
            initGame();
        }

        // Event listeners
        newGameBtn.addEventListener('click', initGame);
        aiToggleBtn.addEventListener('click', toggleAI);

        // Initialize the game on load
        initGame();
    </script>
</body>
</html>